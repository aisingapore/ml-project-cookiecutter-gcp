<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content {{cookiecutter.description}}&quot;&quot;><meta name=author content={{cookiecutter.author_name}}><link rel=icon href=../../assets/favicon.svg><meta name=generator content="mkdocs-1.1.2, mkdocs-material-7.1.5"><title>Job Orchestration - {{cookiecutter.project_name}}</title><link rel=stylesheet href=../../assets/stylesheets/main.bde7dde4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ef6f36e2.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style></head> <body dir=ltr data-md-color-scheme=aisg data-md-color-primary=red data-md-color-accent=red> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#job-orchestration class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title={{cookiecutter.project_name}} class="md-header__button md-logo" aria-label={{cookiecutter.project_name}} data-md-component=logo> <img src=../../assets/aisg-logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> {{cookiecutter.project_name}} </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Job Orchestration </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=aisg data-md-color-primary=red data-md-color-accent=red type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/aisingapore/ml-project-cookiecutter-gcp title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> aisingapore/ml-project-cookiecutter-gcp </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../01-prerequisites/ class="md-tabs__link md-tabs__link--active"> User Guide </a> </li> <li class=md-tabs__item> <a href=../../guide-for-admin/01-prerequisites/ class=md-tabs__link> Admin Guide </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title={{cookiecutter.project_name}} class="md-nav__button md-logo" aria-label={{cookiecutter.project_name}} data-md-component=logo> <img src=../../assets/aisg-logo.png alt=logo> </a> {{cookiecutter.project_name}} </label> <div class=md-nav__source> <a href=https://github.com/aisingapore/ml-project-cookiecutter-gcp title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> aisingapore/ml-project-cookiecutter-gcp </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> User Guide <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User Guide" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../01-prerequisites/ class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=../02-preface/ class=md-nav__link> Preface </a> </li> <li class=md-nav__item> <a href=../03-mlops-components-platform/ class=md-nav__link> MLOps Components & Platform </a> </li> <li class=md-nav__item> <a href=../04-dev-env/ class=md-nav__link> Development Environment </a> </li> <li class=md-nav__item> <a href=../05-virtual-env/ class=md-nav__link> Virtual Environment </a> </li> <li class=md-nav__item> <a href=../06-data-storage-versioning/ class=md-nav__link> Data Storage & Versioning </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Job Orchestration <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Job Orchestration </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#pipeline-configuration class=md-nav__link> Pipeline Configuration </a> </li> <li class=md-nav__item> <a href=#data-preparation-preprocessing class=md-nav__link> Data Preparation &amp; Preprocessing </a> </li> <li class=md-nav__item> <a href=#model-training class=md-nav__link> Model Training </a> <nav class=md-nav aria-label="Model Training"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#experiment-tracking class=md-nav__link> Experiment Tracking </a> </li> <li class=md-nav__item> <a href=#container-for-experiment-job class=md-nav__link> Container for Experiment Job </a> </li> <li class=md-nav__item> <a href=#hyperparameter-tuning class=md-nav__link> Hyperparameter Tuning </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../08-deployment/ class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=../09-batch-inferencing/ class=md-nav__link> Batch Inferencing </a> </li> <li class=md-nav__item> <a href=../10-cicd/ class=md-nav__link> CI/CD </a> </li> <li class=md-nav__item> <a href=../11-documentation/ class=md-nav__link> Documentation </a> </li> <li class=md-nav__item> <a href=../12-streamlit/ class=md-nav__link> Streamlit </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Admin Guide <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Admin Guide" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Admin Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guide-for-admin/01-prerequisites/ class=md-nav__link> Prerequisites </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#pipeline-configuration class=md-nav__link> Pipeline Configuration </a> </li> <li class=md-nav__item> <a href=#data-preparation-preprocessing class=md-nav__link> Data Preparation &amp; Preprocessing </a> </li> <li class=md-nav__item> <a href=#model-training class=md-nav__link> Model Training </a> <nav class=md-nav aria-label="Model Training"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#experiment-tracking class=md-nav__link> Experiment Tracking </a> </li> <li class=md-nav__item> <a href=#container-for-experiment-job class=md-nav__link> Container for Experiment Job </a> </li> <li class=md-nav__item> <a href=#hyperparameter-tuning class=md-nav__link> Hyperparameter Tuning </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=job-orchestration>Job Orchestration<a class=headerlink href=#job-orchestration title="Permanent link">&para;</a></h1> <p>Even though we can set up development workspaces to execute jobs and workflows, these environments often have limited access to resources. To carry out heavier workloads, we encourage the usage of job orchestration features that the Polyaxon platform has.</p> <p>Jobs are submitted to the Polyaxon server and executed within Docker containers. These images are either pulled from a registry or built upon a job's submission. The names and definitions of images are specified in Polyaxonfiles. Using these images, Kubernetes pods are spun up to execute the entry points or commands defined, tapping on to the Kubernetes cluster's available resources.</p> <p>Any jobs that are submitted to the Polyaxon server can be tracked and monitored through Polyaxon's dashboard. See <a href=../03-mlops-components-platform/#polyaxon-dashboard>this section</a> on how to access the dashboard for Polyaxon and create a project.</p> <h2 id=pipeline-configuration>Pipeline Configuration<a class=headerlink href=#pipeline-configuration title="Permanent link">&para;</a></h2> <p>In this template, Hydra is the configuration framework of choice for the data preparation and model training pipelines (or any pipelines that doesn't belong to the model serving aspects).</p> <p>The configurations for logging, pipelines and hyperparameter tuning can be found under <code>conf/base</code>. These YAML files are then referred to by Hydra or general utility functions (<code>src/{{cookiecutter.src_package_name}}/general_utils.py</code>) for loading of parameters and configurations. The defined default values can be overridden through the CLI.</p> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>It is recommended that you have a basic understanding of <a href=https://hydra.cc/ >Hydra</a>'s concepts before you move on.</p> </div> <p><strong>Reference(s):</strong></p> <ul> <li><a href=https://hydra.cc/docs/advanced/override_grammar/basic/ >Hydra Docs - Basic Override Syntax</a></li> </ul> <h2 id=data-preparation-preprocessing>Data Preparation &amp; Preprocessing<a class=headerlink href=#data-preparation-preprocessing title="Permanent link">&para;</a></h2> <p _=% cookiecutter.gcr_personal_subdir=cookiecutter.gcr_personal_subdir if=if>To process the sample raw data, we will be spinning up a job on Polyaxon. This job will be using a Docker image that will be built from a Dockerfile (<code>docker/{{cookiecutter.repo_name}}-data-prep.Dockerfile</code>) provided in this template:</p> <div class=tabbed-set data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><label for=__tabbed_1_1>Linux/macOS</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>$ <span class=nb>export</span> <span class=nv>GCP_PROJECT_ID</span><span class=o>={{</span>cookiecutter.gcp_project_id<span class=o>}}</span>
$ docker build <span class=se>\</span>
    -t asia.gcr.io/<span class=nv>$GCP_PROJECT_ID</span>/data-prep:0.1.0 <span class=se>\</span>
    -f docker/<span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span>-data-prep.Dockerfile <span class=se>\</span>
    --platform linux/amd64 .
$ docker push asia.gcr.io/<span class=nv>$GCP_PROJECT_ID</span>/data-prep:0.1.0
</code></pre></div> </div> <input id=__tabbed_1_2 name=__tabbed_1 type=radio><label for=__tabbed_1_2>Windows PowerShell</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=p>$</span> <span class=nv>$GCP_PROJECT_ID</span><span class=p>=</span><span class=s1>&#39;{{cookiecutter.gcp_project_id}}&#39;</span>
<span class=p>$</span> <span class=n>docker</span> <span class=n>build</span> <span class=p>`</span>
    <span class=n>-t</span> <span class=n>asia</span><span class=p>.</span><span class=n>gcr</span><span class=p>.</span><span class=n>io</span><span class=p>/</span><span class=nv>$GCP_PROJECT_ID</span><span class=p>/</span><span class=n>data-prep</span><span class=p>:</span><span class=n>0</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>0</span> <span class=p>`</span>
    <span class=o>-f</span> <span class=n>docker</span><span class=p>/{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>repo_name</span><span class=p>}}</span><span class=n>-data-prep</span><span class=p>.</span><span class=n>Dockerfile</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-platform</span> <span class=n>linux</span><span class=p>/</span><span class=n>amd64</span> <span class=p>.</span>
<span class=p>$</span> <span class=n>docker</span> <span class=n>push</span> <span class=n>asia</span><span class=p>.</span><span class=n>gcr</span><span class=p>.</span><span class=n>io</span><span class=p>/</span><span class=nv>$GCP_PROJECT_ID</span><span class=p>/</span><span class=n>data-prep</span><span class=p>:</span><span class=n>0</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>0</span>
</code></pre></div> </div> </div> <p>{% elif cookiecutter.gcr_personal_subdir == 'Yes' %}</p> <div class=tabbed-set data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><label for=__tabbed_2_1>Linux/macOS</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>$ <span class=nb>export</span> <span class=nv>GCP_PROJECT_ID</span><span class=o>={{</span>cookiecutter.gcp_project_id<span class=o>}}</span>
$ docker build <span class=se>\</span>
    -t asia.gcr.io/<span class=nv>$GCP_PROJECT_ID</span>/<span class=o>{{</span>cookiecutter.author_name<span class=o>}}</span>/data-prep:0.1.0 <span class=se>\</span>
    -f docker/<span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span>-data-prep.Dockerfile <span class=se>\</span>
    --platform linux/amd64 .
$ docker push asia.gcr.io/<span class=nv>$GCP_PROJECT_ID</span>/<span class=o>{{</span>cookiecutter.author_name<span class=o>}}</span>/data-prep:0.1.0
</code></pre></div> </div> <input id=__tabbed_2_2 name=__tabbed_2 type=radio><label for=__tabbed_2_2>Windows PowerShell</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=p>$</span> <span class=nv>$GCP_PROJECT_ID</span><span class=p>=</span><span class=s1>&#39;{{cookiecutter.gcp_project_id}}&#39;</span>
<span class=p>$</span> <span class=n>docker</span> <span class=n>build</span> <span class=p>`</span>
    <span class=n>-t</span> <span class=n>asia</span><span class=p>.</span><span class=n>gcr</span><span class=p>.</span><span class=n>io</span><span class=p>/</span><span class=nv>$GCP_PROJECT_ID</span><span class=p>/{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>author_name</span><span class=p>}}/</span><span class=n>data-prep</span><span class=p>:</span><span class=n>0</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>0</span> <span class=p>`</span>
    <span class=o>-f</span> <span class=n>docker</span><span class=p>/{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>repo_name</span><span class=p>}}</span><span class=n>-data-prep</span><span class=p>.</span><span class=n>Dockerfile</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-platform</span> <span class=n>linux</span><span class=p>/</span><span class=n>amd64</span> <span class=p>.</span>
<span class=p>$</span> <span class=n>docker</span> <span class=n>push</span> <span class=n>asia</span><span class=p>.</span><span class=n>gcr</span><span class=p>.</span><span class=n>io</span><span class=p>/</span><span class=nv>$GCP_PROJECT_ID</span><span class=p>/{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>author_name</span><span class=p>}}/</span><span class=n>data-prep</span><span class=p>:</span><span class=n>0</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>0</span>
</code></pre></div> </div> </div> <p _=% cookiecutter.gcr_personal_subdir=cookiecutter.gcr_personal_subdir if=if>{% endif %} Assuming you're still connected to the Polyaxon server through port-forwarding, submit a job to the server like such:</p> <div class=tabbed-set data-tabs=3:2><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><label for=__tabbed_3_1>Linux/macOS</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>$ polyaxon run -f aisg-context/polyaxon/polyaxonfiles/process-data.yml <span class=se>\</span>
    -P <span class=nv>DOCKER_IMAGE</span><span class=o>=</span><span class=s2>&quot;asia.gcr.io/</span><span class=nv>$GCP_PROJECT_ID</span><span class=s2>/data-prep:0.1.0&quot;</span> <span class=se>\</span>
    -P <span class=nv>RAW_DATA_DIRS</span><span class=o>=</span><span class=s1>&#39;[&quot;/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/acl-movie-review-data-aisg/aclImdb-aisg-set1&quot;]&#39;</span> <span class=se>\</span>
    -P <span class=nv>PROCESSED_DATA_DIR</span><span class=o>=</span><span class=s2>&quot;/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/processed/aclImdb-aisg-combined&quot;</span> <span class=se>\</span>
    -P <span class=nv>WORKING_DIR</span><span class=o>=</span><span class=s2>&quot;/home/aisg/{{cookiecutter.repo_name}}&quot;</span> <span class=se>\</span>
    -p <span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span>-&lt;YOUR_NAME&gt;
</code></pre></div> </div> <input id=__tabbed_3_2 name=__tabbed_3 type=radio><label for=__tabbed_3_2>Windows PowerShell</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=p>$</span> <span class=n>polyaxon</span> <span class=n>run</span> <span class=o>-f</span> <span class=n>aisg-context</span><span class=p>/</span><span class=n>polyaxon</span><span class=p>/</span><span class=n>polyaxonfiles</span><span class=p>/</span><span class=k>process</span><span class=n>-data</span><span class=p>.</span><span class=n>yml</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>DOCKER_IMAGE</span><span class=p>=</span><span class=s2>&quot;asia.gcr.io/$GCP_PROJECT_ID/data-prep:0.1.0&quot;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>RAW_DATA_DIRS</span><span class=p>=</span><span class=s2>&quot;[&#39;/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/acl-movie-review-data-aisg/aclImdb-aisg-set1&#39;]&quot;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>PROCESSED_DATA_DIR</span><span class=p>=</span><span class=s2>&quot;/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/processed/aclImdb-aisg-combined&quot;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>WORKING_DIR</span><span class=p>=</span><span class=s2>&quot;/home/aisg/{{cookiecutter.repo_name}}&quot;</span> <span class=p>`</span>
    <span class=n>-p</span> <span class=p>{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>repo_name</span><span class=p>}}-&lt;</span><span class=n>YOUR_NAME</span><span class=p>&gt;</span>
</code></pre></div> </div> </div> <p>{% elif cookiecutter.gcr_personal_subdir == 'Yes' %}</p> <div class=tabbed-set data-tabs=4:2><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><label for=__tabbed_4_1>Linux/macOS</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>$ polyaxon run -f aisg-context/polyaxon/polyaxonfiles/process-data.yml <span class=se>\</span>
    -P <span class=nv>DOCKER_IMAGE</span><span class=o>=</span><span class=s2>&quot;asia.gcr.io/</span><span class=nv>$GCP_PROJECT_ID</span><span class=s2>/{{cookiecutter.author_name}}/data-prep:0.1.0&quot;</span> <span class=se>\</span>
    -P <span class=nv>RAW_DATA_DIRS</span><span class=o>=</span><span class=s1>&#39;[&quot;/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/acl-movie-review-data-aisg/aclImdb-aisg-set1&quot;]&#39;</span> <span class=se>\</span>
    -P <span class=nv>PROCESSED_DATA_DIR</span><span class=o>=</span><span class=s2>&quot;/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/processed/aclImdb-aisg-combined&quot;</span> <span class=se>\</span>
    -P <span class=nv>WORKING_DIR</span><span class=o>=</span><span class=s2>&quot;/home/aisg/{{cookiecutter.repo_name}}&quot;</span> <span class=se>\</span>
    -p <span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span>-&lt;YOUR_NAME&gt;
</code></pre></div> </div> <input id=__tabbed_4_2 name=__tabbed_4 type=radio><label for=__tabbed_4_2>Windows PowerShell</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=p>$</span> <span class=n>polyaxon</span> <span class=n>run</span> <span class=o>-f</span> <span class=n>aisg-context</span><span class=p>/</span><span class=n>polyaxon</span><span class=p>/</span><span class=n>polyaxonfiles</span><span class=p>/</span><span class=k>process</span><span class=n>-data</span><span class=p>.</span><span class=n>yml</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>DOCKER_IMAGE</span><span class=p>=</span><span class=s2>&quot;asia.gcr.io/$GCP_PROJECT_ID/{{cookiecutter.author_name}}/data-prep:0.1.0&quot;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>RAW_DATA_DIRS</span><span class=p>=</span><span class=s2>&quot;[&#39;/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/acl-movie-review-data-aisg/aclImdb-aisg-set1&#39;]&quot;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>PROCESSED_DATA_DIR</span><span class=p>=</span><span class=s2>&quot;/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/processed/aclImdb-aisg-combined&quot;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>WORKING_DIR</span><span class=p>=</span><span class=s2>&quot;/home/aisg/{{cookiecutter.repo_name}}&quot;</span> <span class=p>`</span>
    <span class=n>-p</span> <span class=p>{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>repo_name</span><span class=p>}}-&lt;</span><span class=n>YOUR_NAME</span><span class=p>&gt;</span>
</code></pre></div> </div> </div> <p>{% endif %}</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>If you were to inspect <code>aisg-context/polyaxon/polyaxonfiles/process-data.yml</code>, the second command with <code>yq</code> overwrites the list of directories specified in the config file <code>conf/base/pipelines.yml</code> for the key <code>.data_prep.raw_dirs_paths</code>. You may specify a list of directory paths with which you can process and combine the results into one single directory. The <code>yq</code> utility is used to overwrite the values in the YAML config as <a href=https://github.com/facebookresearch/hydra/issues/1547>Hydra currently doesn't support modification of list in YAML files</a> .</p> </div> <p>After some time, the data processing job should conclude and we can proceed with training the predictive model. The processed data is exported to the directory <code>/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/processed/aclImdb-aisg-combined</code>. We will be passing this path to the model training workflows.</p> <h2 id=model-training>Model Training<a class=headerlink href=#model-training title="Permanent link">&para;</a></h2> <p>Now that we have processed the raw data, we can look into training the sentiment classification model. The script relevant for this section is <code>src/train_model.py</code>. In this script, you can see it using some utility functions from <code>src/{{cookiecutter.src_package_name}}/general_utils.py</code> as well, most notably the functions for utilising MLflow utilities for tracking experiments. Let's set up the tooling for experiment tracking before we start model experimentation.</p> <h3 id=experiment-tracking>Experiment Tracking<a class=headerlink href=#experiment-tracking title="Permanent link">&para;</a></h3> <p>In the module <code>src/{{cookiecutter.src_package_name}}/general_utils.py</code>, the functions <code>mlflow_init</code> and <code>mlflow_log</code> are used to initialise MLflow experiments as well as log information and artifacts relevant for a run to a remote MLflow Tracking server. An MLflow Tracking server is usually set up within a GKE cluster for projects that requires model experimentation. Artifacts logged through the MLflow API can be uploaded to GCS buckets, assuming the client is authorised for access to GCS.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The username and password for the MLflow Tracking server can be retrieved from the MLOps team or your team lead.</p> </div> <p>To log and upload artifacts to GCS buckets through MLflow, you need to do the following first:</p> <ol> <li>Ensure that the Polyaxon job for model experimentation is configured to use your GCP project's service account credentials. See <a href=../03-mlops-components-platform/#secrets-credentials-on-kubernetes>"Secrets &amp; Credentials on Kubernetes"</a> on how to do this.</li> <li>Create a bucket for storing such artifacts on GCS.</li> <li>Create an MLflow experiment on the tracking server.</li> </ol> <p>Let's create a GCS bucket for storing all your model experiment artifacts (assuming the bucket has yet to be created):</p> <div class="admonition important"> <p class=admonition-title>Important</p> <p>For the purpose of this guide, we will create a bucket with the following name: <code>gs://{{cookiecutter.repo_name}}-artifacts</code>. The Docker images that we will be using to spin up inference servers will download exported model artifacts from this bucket, under a subdirectory <code>mlflow-tracking-server</code>. Hence, the longer path of the directory where all the model artifacts will be stored at will be <code>gs://{{cookiecutter.repo_name}}-artifacts/mlflow-tracking-server</code>.</p> </div> <div class=tabbed-set data-tabs=5:1><input checked=checked id=__tabbed_5_1 name=__tabbed_5 type=radio><label for=__tabbed_5_1>Local Machine / Polyaxon VSCode Terminal</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>$ gsutil mb -p <span class=o>{{</span>cookiecutter.gcp_project_id<span class=o>}}</span> -c STANDARD -l ASIA-SOUTHEAST1 -b on gs://<span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span>-artifacts
Creating gs://<span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span>-artifacts/...
</code></pre></div> </div> </div> <p>Now, let's access the MLflow Tracking server's dashboard to create an experiment for us to log runs to. Open a separate terminal and run the following:</p> <div class=tabbed-set data-tabs=6:1><input checked=checked id=__tabbed_6_1 name=__tabbed_6 type=radio><label for=__tabbed_6_1>Local Machine</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>$ kubectl port-forward service/mlflow-nginx-server-svc <span class=m>5005</span>:5005 --namespace<span class=o>=</span>polyaxon-v1
</code></pre></div> </div> </div> <p>Head over to your web browser and access the following URL: <code>http://localhost:5005</code>. You would be prompted for a username and password and upon a successful entry you should be presented with an interface similar to the one below:</p> <p><img alt="MLflow - Dashboard Experiments View" src=../../assets/screenshots/mlflow-dashboard-exps-view.png></p> <p>We are to collate runs under experiments. See <a href=https://www.mlflow.org/docs/latest/tracking.html#organizing-runs-in-experiments>here</a> for the distinction between runs and experiments. For each experiment, we can specify paths and URLs for which we intend to upload artifacts to.</p> <p>To create an experiment, locate a <code>+</code> button on the top left hand corner of the interface.</p> <p><img alt="MLflow - Create Experiment (Button)" src=../../assets/screenshots/mlflow-dashboard-create-exp-button.png></p> <p _=% endif=endif>A pop-up box follows prompting a name for the experiment and a location for artifacts to be stored at. {% if cookiecutter.gcr_personal_subdir == 'No' %} For the current use case, let's make use of the following path for location of artifacts: <code>gs://{{cookiecutter.repo_name}}-artifacts/mlflow-tracking-server</code>. {% elif cookiecutter.gcr_personal_subdir == 'Yes' %} For the current use case, let's make use of the path we have specified for MLflow artifacts, with your name appended: <code>gs://{{cookiecutter.repo_name}}-artifacts/mlflow-tracking-server/{{cookiecutter.author_name}}</code>. For name of experiment, you can specify a name like so: <code>ml-experiment-{{cookiecutter.author_name}}</code>.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Here are some things to take note when creating an experiment:</p> <ul> <li>Specifying object storage paths for a new experiment through MLflow's CLI does not work well currently so we would have to make do with creation of experiments through the UI.</li> <li>It is highly recommended that experiment names are <strong>without whitespaces</strong>. Words can be concatenated with hyphens.</li> </ul> </div> <p><img alt="MLflow - Create Experiment (Input)" src=../../assets/screenshots/mlflow-dashboard-create-exp-input.png></p> <p><strong>Reference(s):</strong></p> <ul> <li><a href=https://www.mlflow.org/docs/latest/tracking.html#>MLflow Docs - Tracking</a></li> <li><a href=https://www.mlflow.org/docs/latest/tracking.html#artifact-stores>MLflow Docs - Tracking (Artifact Stores)</a></li> </ul> <h3 id=container-for-experiment-job>Container for Experiment Job<a class=headerlink href=#container-for-experiment-job title="Permanent link">&para;</a></h3> <p _=% cookiecutter.gcr_personal_subdir=cookiecutter.gcr_personal_subdir if=if>Before we submit a job to Polyaxon to train our model, we need to build the Docker image to be used for it:</p> <div class=tabbed-set data-tabs=7:2><input checked=checked id=__tabbed_7_1 name=__tabbed_7 type=radio><label for=__tabbed_7_1>Linux/macOS</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>$ docker build <span class=se>\</span>
    -t asia.gcr.io/<span class=nv>$GCP_PROJECT_ID</span>/model-train:0.1.0 <span class=se>\</span>
    -f docker/<span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span>-model-training-gpu.Dockerfile <span class=se>\</span>
    --platform linux/amd64 .
$ docker push asia.gcr.io/<span class=nv>$GCP_PROJECT_ID</span>/model-train:0.1.0
</code></pre></div> </div> <input id=__tabbed_7_2 name=__tabbed_7 type=radio><label for=__tabbed_7_2>Windows PowerShell</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=p>$</span> <span class=n>docker</span> <span class=n>build</span> <span class=p>`</span>
    <span class=n>-t</span> <span class=n>asia</span><span class=p>.</span><span class=n>gcr</span><span class=p>.</span><span class=n>io</span><span class=p>/</span><span class=nv>$GCP_PROJECT_ID</span><span class=p>/</span><span class=n>model-train</span><span class=p>:</span><span class=n>0</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>0</span> <span class=p>`</span>
    <span class=o>-f</span> <span class=n>docker</span><span class=p>/{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>repo_name</span><span class=p>}}</span><span class=n>-model-training-gpu</span><span class=p>.</span><span class=n>Dockerfile</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-platform</span> <span class=n>linux</span><span class=p>/</span><span class=n>amd64</span> <span class=p>.</span>
<span class=p>$</span> <span class=n>docker</span> <span class=n>push</span> <span class=n>asia</span><span class=p>.</span><span class=n>gcr</span><span class=p>.</span><span class=n>io</span><span class=p>/</span><span class=nv>$GCP_PROJECT_ID</span><span class=p>/</span><span class=n>model-train</span><span class=p>:</span><span class=n>0</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>0</span>
</code></pre></div> </div> </div> <p>{% elif cookiecutter.gcr_personal_subdir == 'Yes' %}</p> <div class=tabbed-set data-tabs=8:2><input checked=checked id=__tabbed_8_1 name=__tabbed_8 type=radio><label for=__tabbed_8_1>Linux/macOS</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>$ docker build <span class=se>\</span>
    -t asia.gcr.io/<span class=nv>$GCP_PROJECT_ID</span>/<span class=o>{{</span>cookiecutter.author_name<span class=o>}}</span>/model-train:0.1.0 <span class=se>\</span>
    -f docker/<span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span>-model-training-gpu.Dockerfile <span class=se>\</span>
    --platform linux/amd64 .
$ docker push asia.gcr.io/<span class=nv>$GCP_PROJECT_ID</span>/<span class=o>{{</span>cookiecutter.author_name<span class=o>}}</span>/model-train:0.1.0
</code></pre></div> </div> <input id=__tabbed_8_2 name=__tabbed_8 type=radio><label for=__tabbed_8_2>Windows PowerShell</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=p>$</span> <span class=n>docker</span> <span class=n>build</span> <span class=p>`</span>
    <span class=n>-t</span> <span class=n>asia</span><span class=p>.</span><span class=n>gcr</span><span class=p>.</span><span class=n>io</span><span class=p>/</span><span class=nv>$GCP_PROJECT_ID</span><span class=p>/{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>author_name</span><span class=p>}}/</span><span class=n>model-train</span><span class=p>:</span><span class=n>0</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>0</span> <span class=p>`</span>
    <span class=o>-f</span> <span class=n>docker</span><span class=p>/{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>repo_name</span><span class=p>}}</span><span class=n>-model-training-gpu</span><span class=p>.</span><span class=n>Dockerfile</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-platform</span> <span class=n>linux</span><span class=p>/</span><span class=n>amd64</span> <span class=p>.</span>
<span class=p>$</span> <span class=n>docker</span> <span class=n>push</span> <span class=n>asia</span><span class=p>.</span><span class=n>gcr</span><span class=p>.</span><span class=n>io</span><span class=p>/</span><span class=nv>$GCP_PROJECT_ID</span><span class=p>/{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>author_name</span><span class=p>}}/</span><span class=n>model-train</span><span class=p>:</span><span class=n>0</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>0</span>
</code></pre></div> </div> </div> <p>{% endif %} Now that we have the Docker image pushed to the registry, we can run a job using it:</p> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>If the GKE cluster is without GPU nodes, the <strong>Polyaxonfiles would have to be edited</strong> to remove any request for GPUs (otherwise the job cannot be scheduled).</p> <p><strong>Delete the following lines:</strong> <div class=highlight><pre><span></span><code><span class=nn>...</span><span class=w></span>
<span class=w>    </span><span class=nt>tolerations</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;nvidia.com/gpu&quot;</span><span class=w></span>
<span class=w>        </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Equal&quot;</span><span class=w></span>
<span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;present&quot;</span><span class=w></span>
<span class=w>        </span><span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=s>&quot;NoSchedule&quot;</span><span class=w></span>
<span class=nn>...</span><span class=w></span>
<span class=w>        </span><span class=nt>nvidia.com/gpu</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class=w></span>
<span class=nn>...</span><span class=w></span>
</code></pre></div></p> </div> <p>{% if cookiecutter.gcr_personal_subdir == 'No' %}</p> <div class=tabbed-set data-tabs=9:2><input checked=checked id=__tabbed_9_1 name=__tabbed_9 type=radio><label for=__tabbed_9_1>Linux/macOS</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>$ <span class=nb>export</span> <span class=nv>MLFLOW_TRACKING_USERNAME</span><span class=o>=</span>&lt;MLFLOW_TRACKING_USERNAME&gt;
$ <span class=nb>export</span> <span class=nv>MLFLOW_TRACKING_PASSWORD</span><span class=o>=</span>&lt;MLFLOW_TRACKING_PASSWORD&gt;
$ <span class=nb>export</span> <span class=nv>CLUSTER_IP_OF_MLFLOW_SERVICE</span><span class=o>=</span><span class=k>$(</span>kubectl get service/mlflow-nginx-server-svc -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.spec.clusterIP}&#39;</span> --namespace<span class=o>=</span>polyaxon-v1<span class=k>)</span>
$ polyaxon run -f aisg-context/polyaxon/polyaxonfiles/train-model-gpu.yml <span class=se>\</span>
    -P <span class=nv>DOCKER_IMAGE</span><span class=o>=</span><span class=s2>&quot;asia.gcr.io/</span><span class=nv>$GCP_PROJECT_ID</span><span class=s2>/model-train:0.1.0&quot;</span> <span class=se>\</span>
    -P <span class=nv>MLFLOW_TRACKING_USERNAME</span><span class=o>=</span><span class=nv>$MLFLOW_TRACKING_USERNAME</span> -P <span class=nv>MLFLOW_TRACKING_PASSWORD</span><span class=o>=</span><span class=nv>$MLFLOW_TRACKING_PASSWORD</span> <span class=se>\</span>
    -P <span class=nv>SETUP_MLFLOW</span><span class=o>=</span><span class=nb>true</span> -P <span class=nv>MLFLOW_AUTOLOG</span><span class=o>=</span><span class=nb>true</span> <span class=se>\</span>
    -P <span class=nv>MLFLOW_TRACKING_URI</span><span class=o>=</span><span class=s2>&quot;http://</span><span class=nv>$CLUSTER_IP_OF_MLFLOW_SERVICE</span><span class=s2>:5005&quot;</span> -P <span class=nv>MLFLOW_EXP_NAME</span><span class=o>=</span>&lt;MLFLOW_EXPERIMENT_NAME&gt; <span class=se>\</span>
    -P <span class=nv>WORKING_DIR</span><span class=o>=</span><span class=s2>&quot;/home/aisg/{{cookiecutter.repo_name}}&quot;</span> <span class=se>\</span>
    -P <span class=nv>INPUT_DATA_DIR</span><span class=o>=</span><span class=s2>&quot;/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/processed/aclImdb-aisg-combined&quot;</span> <span class=se>\</span>
    -p <span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span>-&lt;YOUR_NAME&gt;
</code></pre></div> </div> <input id=__tabbed_9_2 name=__tabbed_9 type=radio><label for=__tabbed_9_2>Windows PowerShell</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=p>$</span> <span class=nv>$MLFLOW_TRACKING_USERNAME</span><span class=p>=</span><span class=s1>&#39;&lt;MLFLOW_TRACKING_USERNAME&gt;&#39;</span>
<span class=p>$</span> <span class=nv>$MLFLOW_TRACKING_PASSWORD</span><span class=p>=</span><span class=s1>&#39;&lt;MLFLOW_TRACKING_PASSWORD&gt;&#39;</span>
<span class=p>$</span> <span class=nv>$CLUSTER_IP_OF_MLFLOW_SERVICE</span><span class=p>=$(</span><span class=n>kubectl</span> <span class=n>get</span> <span class=n>service</span><span class=p>/</span><span class=n>mlflow-nginx-server-svc</span> <span class=n>-o</span> <span class=n>jsonpath</span><span class=p>=</span><span class=s1>&#39;{.spec.clusterIP}&#39;</span> <span class=p>-</span><span class=n>-namespace</span><span class=p>=</span><span class=n>polyaxon-v1</span><span class=p>)</span>
<span class=p>$</span> <span class=n>polyaxon</span> <span class=n>run</span> <span class=o>-f</span> <span class=n>aisg-context</span><span class=p>/</span><span class=n>polyaxon</span><span class=p>/</span><span class=n>polyaxonfiles</span><span class=p>/</span><span class=n>train-model-gpu</span><span class=p>.</span><span class=n>yml</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>DOCKER_IMAGE</span><span class=p>=</span><span class=s2>&quot;asia.gcr.io/$GCP_PROJECT_ID/model-train:0.1.0&quot;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>MLFLOW_TRACKING_USERNAME</span><span class=p>=</span><span class=nv>$MLFLOW_TRACKING_USERNAME</span> <span class=n>-P</span> <span class=n>MLFLOW_TRACKING_PASSWORD</span><span class=p>=</span><span class=nv>$MLFLOW_TRACKING_PASSWORD</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>SETUP_MLFLOW</span><span class=p>=</span><span class=n>true</span> <span class=n>-P</span> <span class=n>MLFLOW_AUTOLOG</span><span class=p>=</span><span class=n>true</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>MLFLOW_TRACKING_URI</span><span class=p>=</span><span class=s2>&quot;http://$CLUSTER_IP_OF_MLFLOW_SERVICE`:5005&quot;</span> <span class=n>-P</span> <span class=n>MLFLOW_EXP_NAME</span><span class=p>=&lt;</span><span class=n>MLFLOW_EXPERIMENT_NAME</span><span class=p>&gt;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>WORKING_DIR</span><span class=p>=</span><span class=s2>&quot;/home/aisg/{{cookiecutter.repo_name}}&quot;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>INPUT_DATA_DIR</span><span class=p>=</span><span class=s2>&quot;/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/processed/aclImdb-aisg-combined&quot;</span> <span class=p>`</span>
    <span class=n>-p</span> <span class=p>{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>repo_name</span><span class=p>}}-&lt;</span><span class=n>YOUR_NAME</span><span class=p>&gt;</span>
</code></pre></div> </div> </div> <p>{% elif cookiecutter.gcr_personal_subdir == 'Yes' %}</p> <div class=tabbed-set data-tabs=10:2><input checked=checked id=__tabbed_10_1 name=__tabbed_10 type=radio><label for=__tabbed_10_1>Linux/macOS</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>$ <span class=nb>export</span> <span class=nv>MLFLOW_TRACKING_USERNAME</span><span class=o>=</span>&lt;MLFLOW_TRACKING_USERNAME&gt;
$ <span class=nb>export</span> <span class=nv>MLFLOW_TRACKING_PASSWORD</span><span class=o>=</span>&lt;MLFLOW_TRACKING_PASSWORD&gt;
$ <span class=nb>export</span> <span class=nv>CLUSTER_IP_OF_MLFLOW_SERVICE</span><span class=o>=</span><span class=k>$(</span>kubectl get service/mlflow-nginx-server-svc -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.spec.clusterIP}&#39;</span> --namespace<span class=o>=</span>polyaxon-v1<span class=k>)</span>
$ polyaxon run -f aisg-context/polyaxon/polyaxonfiles/train-model-gpu.yml <span class=se>\</span>
    -P <span class=nv>DOCKER_IMAGE</span><span class=o>=</span><span class=s2>&quot;asia.gcr.io/</span><span class=nv>$GCP_PROJECT_ID</span><span class=s2>/{{cookiecutter.author_name}}/model-train:0.1.0&quot;</span> <span class=se>\</span>
    -P <span class=nv>MLFLOW_TRACKING_USERNAME</span><span class=o>=</span><span class=nv>$MLFLOW_TRACKING_USERNAME</span> -P <span class=nv>MLFLOW_TRACKING_PASSWORD</span><span class=o>=</span><span class=nv>$MLFLOW_TRACKING_PASSWORD</span> <span class=se>\</span>
    -P <span class=nv>SETUP_MLFLOW</span><span class=o>=</span><span class=nb>true</span> -P <span class=nv>MLFLOW_AUTOLOG</span><span class=o>=</span><span class=nb>true</span> <span class=se>\</span>
    -P <span class=nv>MLFLOW_TRACKING_URI</span><span class=o>=</span><span class=s2>&quot;http://</span><span class=nv>$CLUSTER_IP_OF_MLFLOW_SERVICE</span><span class=s2>:5005&quot;</span> -P <span class=nv>MLFLOW_EXP_NAME</span><span class=o>=</span>&lt;MLFLOW_EXPERIMENT_NAME&gt; <span class=se>\</span>
    -P <span class=nv>WORKING_DIR</span><span class=o>=</span><span class=s2>&quot;/home/aisg/{{cookiecutter.repo_name}}&quot;</span> <span class=se>\</span>
    -P <span class=nv>INPUT_DATA_DIR</span><span class=o>=</span><span class=s2>&quot;/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/processed/aclImdb-aisg-combined&quot;</span> <span class=se>\</span>
    -p <span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span>-&lt;YOUR_NAME&gt;
</code></pre></div> </div> <input id=__tabbed_10_2 name=__tabbed_10 type=radio><label for=__tabbed_10_2>Windows PowerShell</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=p>$</span> <span class=nv>$MLFLOW_TRACKING_USERNAME</span><span class=p>=</span><span class=s1>&#39;&lt;MLFLOW_TRACKING_USERNAME&gt;&#39;</span>
<span class=p>$</span> <span class=nv>$MLFLOW_TRACKING_PASSWORD</span><span class=p>=</span><span class=s1>&#39;&lt;MLFLOW_TRACKING_PASSWORD&gt;&#39;</span>
<span class=p>$</span> <span class=nv>$CLUSTER_IP_OF_MLFLOW_SERVICE</span><span class=p>=$(</span><span class=n>kubectl</span> <span class=n>get</span> <span class=n>service</span><span class=p>/</span><span class=n>mlflow-nginx-server-svc</span> <span class=n>-o</span> <span class=n>jsonpath</span><span class=p>=</span><span class=s1>&#39;{.spec.clusterIP}&#39;</span> <span class=p>-</span><span class=n>-namespace</span><span class=p>=</span><span class=n>polyaxon-v1</span><span class=p>)</span>
<span class=p>$</span> <span class=n>polyaxon</span> <span class=n>run</span> <span class=o>-f</span> <span class=n>aisg-context</span><span class=p>/</span><span class=n>polyaxon</span><span class=p>/</span><span class=n>polyaxonfiles</span><span class=p>/</span><span class=n>train-model-gpu</span><span class=p>.</span><span class=n>yml</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>DOCKER_IMAGE</span><span class=p>=</span><span class=s2>&quot;asia.gcr.io/$GCP_PROJECT_ID/{{cookiecutter.author_name}}/model-train:0.1.0&quot;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>MLFLOW_TRACKING_USERNAME</span><span class=p>=</span><span class=nv>$MLFLOW_TRACKING_USERNAME</span> <span class=n>-P</span> <span class=n>MLFLOW_TRACKING_PASSWORD</span><span class=p>=</span><span class=nv>$MLFLOW_TRACKING_PASSWORD</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>SETUP_MLFLOW</span><span class=p>=</span><span class=n>true</span> <span class=n>-P</span> <span class=n>MLFLOW_AUTOLOG</span><span class=p>=</span><span class=n>true</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>MLFLOW_TRACKING_URI</span><span class=p>=</span><span class=s2>&quot;http://$CLUSTER_IP_OF_MLFLOW_SERVICE`:5005&quot;</span> <span class=n>-P</span> <span class=n>MLFLOW_EXP_NAME</span><span class=p>=&lt;</span><span class=n>MLFLOW_EXPERIMENT_NAME</span><span class=p>&gt;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>WORKING_DIR</span><span class=p>=</span><span class=s2>&quot;/home/aisg/{{cookiecutter.repo_name}}&quot;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>INPUT_DATA_DIR</span><span class=p>=</span><span class=s2>&quot;/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/processed/aclImdb-aisg-combined&quot;</span> <span class=p>`</span>
    <span class=n>-p</span> <span class=p>{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>repo_name</span><span class=p>}}-&lt;</span><span class=n>YOUR_NAME</span><span class=p>&gt;</span>
</code></pre></div> </div> </div> <p>{% endif %} !!! caution Do take note of the backtick (`) before the colon in the value for the parameter <code>MLFLOW_TRACKING_URI</code>. See <a href=https://stackoverflow.com/questions/8386219/powershell-string-formatting-why-is-the-colon-character-causing-my-variables-v>here</a> for some explanation.</p> <h3 id=hyperparameter-tuning>Hyperparameter Tuning<a class=headerlink href=#hyperparameter-tuning title="Permanent link">&para;</a></h3> <p>For many ML problems, we would be bothered with finding the optimal parameters to train our models with. While we are able to override the parameters for our model training workflows, imagine having to sweep through a distribution of values. For example, if you were to seek for the optimal learning rate within a log space, we would have to execute <code>polyaxon run</code> a myriad of times manually, just to provide the training script with a different learning rate value each time. It is reasonable that one seeks for ways to automate this workflow.</p> <p><a href=https://optuna.readthedocs.io/en/stable/ >Optuna</a> is an optimisation framework designed for ML use-cases. Its features includes:</p> <ul> <li>ease of modularity,</li> <li>optimisation algorithms for searching the best set of parameters,</li> <li>and <a href=https://optuna.readthedocs.io/en/stable/tutorial/10_key_features/004_distributed.html>paralellisation</a> capabilities for faster sweeps.</li> </ul> <p>In addition, Hydra has a plugin for utilising Optuna which further translates to ease of configuration. To use Hydra's plugin for Optuna, we have to provide further overrides within the YAML config, and this is observed in <code>conf/base/train-model-hptuning.yml</code>:</p> <div class=highlight><pre><span></span><code><span class=nt>defaults</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>override hydra/sweeper</span><span class=p>:</span><span class=w> </span><span class=s>&quot;optuna&quot;</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>override hydra/sweeper/sampler</span><span class=p>:</span><span class=w> </span><span class=s>&quot;tpe&quot;</span><span class=w></span>

<span class=nt>hydra</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>sweeper</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>sampler</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>seed</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">123</span><span class=w></span>
<span class=w>    </span><span class=nt>direction</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;minimize&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;maximize&quot;</span><span class="p p-Indicator">]</span><span class=w></span>
<span class=w>    </span><span class=nt>study_name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;sentiment-classification&quot;</span><span class=w></span>
<span class=w>    </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class=w></span>
<span class=w>    </span><span class=nt>n_trials</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class=w></span>
<span class=w>    </span><span class=nt>n_jobs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class=w></span>

<span class=w>    </span><span class=nt>search_space</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>train.val_split</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s>&quot;float&quot;</span><span class=w></span>
<span class=w>        </span><span class=nt>low</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span><span class=w></span>
<span class=w>        </span><span class=nt>high</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.35</span><span class=w></span>
<span class=w>        </span><span class=nt>step</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.025</span><span class=w></span>
<span class=w>      </span><span class=nt>train.optimiser</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s>&quot;categorical&quot;</span><span class=w></span>
<span class=w>        </span><span class=nt>choices</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;adam&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;rmsprop&quot;</span><span class="p p-Indicator">]</span><span class=w></span>
</code></pre></div> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>The fields defined are terminologies used by Optuna. Therefore, it is recommended that you understand the basics of the tool. <a href="https://www.youtube.com/watch?v=P6NwZVl8ttc">This overview video</a> covers well on the concepts brought upon by Optuna.</p> </div> <p>The script with which hyperparameter tuning is conducted, <code>src/train_model_hptuning.py</code>, has 2 essential lines that are different from <code>src/train_model.py</code>:</p> <div class=highlight><pre><span></span><code><span class=o>...</span>
<span class=nd>@hydra</span><span class=o>.</span><span class=n>main</span><span class=p>(</span><span class=n>config_path</span><span class=o>=</span><span class=s2>&quot;../conf/base&quot;</span><span class=p>,</span> <span class=n>config_name</span><span class=o>=</span><span class=s2>&quot;train-model-hptuning.yml&quot;</span><span class=p>)</span>
<span class=o>...</span>
    <span class=k>return</span> <span class=n>test_loss</span><span class=p>,</span><span class=n>test_acc</span>
</code></pre></div> <p>The first change specifies the different config file needed for utilising the Optuna plugin. The second one is needed for Optuna to judge the performance of the objectives (i.e. metrics) within each iteration, or as they put it, "trials".</p> <p _=% cookiecutter.gcr_personal_subdir=cookiecutter.gcr_personal_subdir if=if>Another difference with this workflow is that for each trial with a different set of parameters, a new MLflow run has to be initialised. However, we need to somehow link all these different runs together so that we can compare all the runs within a single Optuna study (set of trials). How we do this is that we provide the script with a tag (<code>hptuning_tag</code>) which would essentially be the date epoch value of the moment you submitted the job to Polyaxon. This tag is defined using the environment value <code>MLFLOW_HPTUNING_TAG</code>.</p> <div class=tabbed-set data-tabs=11:2><input checked=checked id=__tabbed_11_1 name=__tabbed_11 type=radio><label for=__tabbed_11_1>Linux/macOS</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>$ <span class=nb>export</span> <span class=nv>MLFLOW_TRACKING_USERNAME</span><span class=o>=</span>&lt;MLFLOW_TRACKING_USERNAME&gt;
$ <span class=nb>export</span> <span class=nv>MLFLOW_TRACKING_PASSWORD</span><span class=o>=</span>&lt;MLFLOW_TRACKING_PASSWORD&gt;
$ <span class=nb>export</span> <span class=nv>CLUSTER_IP_OF_MLFLOW_SERVICE</span><span class=o>=</span><span class=k>$(</span>kubectl get service/mlflow-nginx-server-svc -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.spec.clusterIP}&#39;</span> --namespace<span class=o>=</span>polyaxon-v1<span class=k>)</span>
$ polyaxon run -f aisg-context/polyaxon/polyaxonfiles/train-model-gpu-hptuning.yml <span class=se>\</span>
    -P <span class=nv>DOCKER_IMAGE</span><span class=o>=</span><span class=s2>&quot;asia.gcr.io/</span><span class=nv>$GCP_PROJECT_ID</span><span class=s2>/model-train:0.1.0&quot;</span> <span class=se>\</span>
    -P <span class=nv>MLFLOW_TRACKING_USERNAME</span><span class=o>=</span><span class=nv>$MLFLOW_TRACKING_USERNAME</span> -P <span class=nv>MLFLOW_TRACKING_PASSWORD</span><span class=o>=</span><span class=nv>$MLFLOW_TRACKING_PASSWORD</span> <span class=se>\</span>
    -P <span class=nv>SETUP_MLFLOW</span><span class=o>=</span><span class=nb>true</span> -P <span class=nv>MLFLOW_AUTOLOG</span><span class=o>=</span><span class=nb>true</span> <span class=se>\</span>
    -P <span class=nv>MLFLOW_TRACKING_URI</span><span class=o>=</span><span class=s2>&quot;http://</span><span class=nv>$CLUSTER_IP_OF_MLFLOW_SERVICE</span><span class=s2>:5005&quot;</span> -P <span class=nv>MLFLOW_EXP_NAME</span><span class=o>=</span>&lt;MLFLOW_EXPERIMENT_NAME&gt; <span class=se>\</span>
    -P <span class=nv>WORKING_DIR</span><span class=o>=</span><span class=s2>&quot;/home/aisg/{{cookiecutter.repo_name}}&quot;</span> <span class=se>\</span>
    -P <span class=nv>INPUT_DATA_DIR</span><span class=o>=</span><span class=s2>&quot;/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/processed/aclImdb-aisg-combined&quot;</span> <span class=se>\</span>
    -P <span class=nv>MLFLOW_HPTUNING_TAG</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>date +%s<span class=k>)</span><span class=s2>&quot;</span> <span class=se>\</span>
    -p <span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span>-&lt;YOUR_NAME&gt;
</code></pre></div> </div> <input id=__tabbed_11_2 name=__tabbed_11 type=radio><label for=__tabbed_11_2>Windows PowerShell</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=p>$</span> <span class=nv>$MLFLOW_TRACKING_USERNAME</span><span class=p>=</span><span class=s1>&#39;&lt;MLFLOW_TRACKING_USERNAME&gt;&#39;</span>
<span class=p>$</span> <span class=nv>$MLFLOW_TRACKING_PASSWORD</span><span class=p>=</span><span class=s1>&#39;&lt;MLFLOW_TRACKING_PASSWORD&gt;&#39;</span>
<span class=p>$</span> <span class=nv>$CLUSTER_IP_OF_MLFLOW_SERVICE</span><span class=p>=$(</span><span class=n>kubectl</span> <span class=n>get</span> <span class=n>service</span><span class=p>/</span><span class=n>mlflow-nginx-server-svc</span> <span class=n>-o</span> <span class=n>jsonpath</span><span class=p>=</span><span class=s1>&#39;{.spec.clusterIP}&#39;</span> <span class=p>-</span><span class=n>-namespace</span><span class=p>=</span><span class=n>polyaxon-v1</span><span class=p>)</span>
<span class=p>$</span> <span class=n>polyaxon</span> <span class=n>run</span> <span class=o>-f</span> <span class=n>aisg-context</span><span class=p>/</span><span class=n>polyaxon</span><span class=p>/</span><span class=n>polyaxonfiles</span><span class=p>/</span><span class=n>train-model-gpu-hptuning</span><span class=p>.</span><span class=n>yml</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>DOCKER_IMAGE</span><span class=p>=</span><span class=s2>&quot;asia.gcr.io/$GCP_PROJECT_ID/model-train:0.1.0&quot;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>MLFLOW_TRACKING_USERNAME</span><span class=p>=</span><span class=nv>$MLFLOW_TRACKING_USERNAME</span> <span class=n>-P</span> <span class=n>MLFLOW_TRACKING_PASSWORD</span><span class=p>=</span><span class=nv>$MLFLOW_TRACKING_PASSWORD</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>SETUP_MLFLOW</span><span class=p>=</span><span class=n>true</span> <span class=n>-P</span> <span class=n>MLFLOW_AUTOLOG</span><span class=p>=</span><span class=n>true</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>MLFLOW_TRACKING_URI</span><span class=p>=</span><span class=s2>&quot;http://$CLUSTER_IP_OF_MLFLOW_SERVICE`:5005&quot;</span> <span class=n>-P</span> <span class=n>MLFLOW_EXP_NAME</span><span class=p>=&lt;</span><span class=n>MLFLOW_EXPERIMENT_NAME</span><span class=p>&gt;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>WORKING_DIR</span><span class=p>=</span><span class=s2>&quot;/home/aisg/{{cookiecutter.repo_name}}&quot;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>INPUT_DATA_DIR</span><span class=p>=</span><span class=s2>&quot;/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/processed/aclImdb-aisg-combined&quot;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>MLFLOW_HPTUNING_TAG</span><span class=p>=$(</span><span class=nb>Get-Date</span> <span class=n>-UFormat</span> <span class=k>%</span><span class=n>s</span> <span class=n>-Millisecond</span> <span class=n>0</span><span class=p>)</span> <span class=p>`</span>
    <span class=n>-p</span> <span class=p>{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>repo_name</span><span class=p>}}-&lt;</span><span class=n>YOUR_NAME</span><span class=p>&gt;</span>
</code></pre></div> </div> </div> <p>{% elif cookiecutter.gcr_personal_subdir == 'Yes' %}</p> <div class=tabbed-set data-tabs=12:2><input checked=checked id=__tabbed_12_1 name=__tabbed_12 type=radio><label for=__tabbed_12_1>Linux/macOS</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>$ <span class=nb>export</span> <span class=nv>MLFLOW_TRACKING_USERNAME</span><span class=o>=</span>&lt;MLFLOW_TRACKING_USERNAME&gt;
$ <span class=nb>export</span> <span class=nv>MLFLOW_TRACKING_PASSWORD</span><span class=o>=</span>&lt;MLFLOW_TRACKING_PASSWORD&gt;
$ <span class=nb>export</span> <span class=nv>CLUSTER_IP_OF_MLFLOW_SERVICE</span><span class=o>=</span><span class=k>$(</span>kubectl get service/mlflow-nginx-server-svc -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.spec.clusterIP}&#39;</span> --namespace<span class=o>=</span>polyaxon-v1<span class=k>)</span>
$ polyaxon run -f aisg-context/polyaxon/polyaxonfiles/train-model-gpu-hptuning.yml <span class=se>\</span>
    -P <span class=nv>DOCKER_IMAGE</span><span class=o>=</span><span class=s2>&quot;asia.gcr.io/</span><span class=nv>$GCP_PROJECT_ID</span><span class=s2>/{{cookiecutter.author_name}}/model-train:0.1.0&quot;</span> <span class=se>\</span>
    -P <span class=nv>MLFLOW_TRACKING_USERNAME</span><span class=o>=</span><span class=nv>$MLFLOW_TRACKING_USERNAME</span> -P <span class=nv>MLFLOW_TRACKING_PASSWORD</span><span class=o>=</span><span class=nv>$MLFLOW_TRACKING_PASSWORD</span> <span class=se>\</span>
    -P <span class=nv>SETUP_MLFLOW</span><span class=o>=</span><span class=nb>true</span> -P <span class=nv>MLFLOW_AUTOLOG</span><span class=o>=</span><span class=nb>true</span> <span class=se>\</span>
    -P <span class=nv>MLFLOW_TRACKING_URI</span><span class=o>=</span><span class=s2>&quot;http://</span><span class=nv>$CLUSTER_IP_OF_MLFLOW_SERVICE</span><span class=s2>:5005&quot;</span> -P <span class=nv>MLFLOW_EXP_NAME</span><span class=o>=</span>&lt;MLFLOW_EXPERIMENT_NAME&gt; <span class=se>\</span>
    -P <span class=nv>WORKING_DIR</span><span class=o>=</span><span class=s2>&quot;/home/aisg/{{cookiecutter.repo_name}}&quot;</span> <span class=se>\</span>
    -P <span class=nv>INPUT_DATA_DIR</span><span class=o>=</span><span class=s2>&quot;/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/processed/aclImdb-aisg-combined&quot;</span> <span class=se>\</span>
    -P <span class=nv>MLFLOW_HPTUNING_TAG</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>date +%s<span class=k>)</span><span class=s2>&quot;</span> <span class=se>\</span>
    -p <span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span>-&lt;YOUR_NAME&gt;
</code></pre></div> </div> <input id=__tabbed_12_2 name=__tabbed_12 type=radio><label for=__tabbed_12_2>Windows PowerShell</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=p>$</span> <span class=nv>$MLFLOW_TRACKING_USERNAME</span><span class=p>=</span><span class=s1>&#39;&lt;MLFLOW_TRACKING_USERNAME&gt;&#39;</span>
<span class=p>$</span> <span class=nv>$MLFLOW_TRACKING_PASSWORD</span><span class=p>=</span><span class=s1>&#39;&lt;MLFLOW_TRACKING_PASSWORD&gt;&#39;</span>
<span class=p>$</span> <span class=nv>$CLUSTER_IP_OF_MLFLOW_SERVICE</span><span class=p>=$(</span><span class=n>kubectl</span> <span class=n>get</span> <span class=n>service</span><span class=p>/</span><span class=n>mlflow-nginx-server-svc</span> <span class=n>-o</span> <span class=n>jsonpath</span><span class=p>=</span><span class=s1>&#39;{.spec.clusterIP}&#39;</span> <span class=p>-</span><span class=n>-namespace</span><span class=p>=</span><span class=n>polyaxon-v1</span><span class=p>)</span>
<span class=p>$</span> <span class=n>polyaxon</span> <span class=n>run</span> <span class=o>-f</span> <span class=n>aisg-context</span><span class=p>/</span><span class=n>polyaxon</span><span class=p>/</span><span class=n>polyaxonfiles</span><span class=p>/</span><span class=n>train-model-gpu-hptuning</span><span class=p>.</span><span class=n>yml</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>DOCKER_IMAGE</span><span class=p>=</span><span class=s2>&quot;asia.gcr.io/$GCP_PROJECT_ID/{{cookiecutter.author_name}}/model-train:0.1.0&quot;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>MLFLOW_TRACKING_USERNAME</span><span class=p>=</span><span class=nv>$MLFLOW_TRACKING_USERNAME</span> <span class=n>-P</span> <span class=n>MLFLOW_TRACKING_PASSWORD</span><span class=p>=</span><span class=nv>$MLFLOW_TRACKING_PASSWORD</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>SETUP_MLFLOW</span><span class=p>=</span><span class=n>true</span> <span class=n>-P</span> <span class=n>MLFLOW_AUTOLOG</span><span class=p>=</span><span class=n>true</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>MLFLOW_TRACKING_URI</span><span class=p>=</span><span class=s2>&quot;http://$CLUSTER_IP_OF_MLFLOW_SERVICE`:5005&quot;</span> <span class=n>-P</span> <span class=n>MLFLOW_EXP_NAME</span><span class=p>=&lt;</span><span class=n>MLFLOW_EXPERIMENT_NAME</span><span class=p>&gt;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>WORKING_DIR</span><span class=p>=</span><span class=s2>&quot;/home/aisg/{{cookiecutter.repo_name}}&quot;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>INPUT_DATA_DIR</span><span class=p>=</span><span class=s2>&quot;/polyaxon-v1-data/workspaces/&lt;YOUR_NAME&gt;/data/processed/aclImdb-aisg-combined&quot;</span> <span class=p>`</span>
    <span class=n>-P</span> <span class=n>MLFLOW_HPTUNING_TAG</span><span class=p>=$(</span><span class=nb>Get-Date</span> <span class=n>-UFormat</span> <span class=k>%</span><span class=n>s</span> <span class=n>-Millisecond</span> <span class=n>0</span><span class=p>)</span> <span class=p>`</span>
    <span class=n>-p</span> <span class=p>{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>repo_name</span><span class=p>}}-&lt;</span><span class=n>YOUR_NAME</span><span class=p>&gt;</span>
</code></pre></div> </div> </div> <p>{% endif %} !!! caution Do take note of the backtick (`) before the colon in the value for the parameter <code>MLFLOW_TRACKING_URI</code>. See <a href=https://stackoverflow.com/questions/8386219/powershell-string-formatting-why-is-the-colon-character-causing-my-variables-v>here</a> for some explanation.</p> <p>Say the tag is <code>1641159546</code>, you can then filter this within MLflow's dashboard for runs with the associated tag like such in the search bar: <code>tags.hptuning_tag="1641159546"</code>.</p> <p><strong>Reference(s):</strong></p> <ul> <li><a href=https://hydra.cc/docs/plugins/optuna_sweeper/ >Hydra Docs - Optuna Sweeper Plugin</a></li> <li><a href=https://www.mlflow.org/docs/latest/search-syntax.html>MLflow Docs - Search Syntax</a></li> </ul> </article> </div> </div> <a href=# class="md-top md-icon" title="Back to top" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../06-data-storage-versioning/ class="md-footer__link md-footer__link--prev" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Data Storage & Versioning </div> </div> </a> <a href=../08-deployment/ class="md-footer__link md-footer__link--next" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Deployment </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2022 - AI Singapore </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://twitter.com/aisingapore target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://www.linkedin.com/company/aisingapore target=_blank rel=noopener title=www.linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://www.instagram.com/ai_singapore/ target=_blank rel=noopener title=www.instagram.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.d351de03.min.js", "version": {"provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.a1609d9a.min.js></script> </body> </html>